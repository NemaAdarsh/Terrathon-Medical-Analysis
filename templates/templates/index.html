<!DOCTYPE html>
<html>
<head>
    <title>Medical History Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>

.navbar {
            background-color: #262626;
            overflow: hidden;
            display: flex;
            justify-content: space-between; /* Align items to the left and right */
            align-items: center; /* Center items vertically */
            padding: 10px 20px;
            border-bottom: 1px solid #444;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .navbar a {
            color: #fff;
            text-decoration: none;
            font-size: 16px;
            padding: 10px;
            margin-right: 20px;
            transition: all 0.3s ease;
        }

        .navbar a:hover {
            color: #00bcd4;
        }

        /* Container for current time */
        #current-time {
            color: #fff;
            font-size: 18px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-right: 20px;
            border-right: 1px solid #444;
            margin-right: 20px;
        }





    body {
        font-family: 'Roboto', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
        color: #333;
    }
    .container {
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }
    h1 {
        text-align: center;
        color: #007bff;
        margin-bottom: 30px;
        font-size: 36px;
        position: sticky;
    }
    form {
        text-align: center;
        margin-bottom: 30px;
    }
    label {
        cursor: pointer;
        background-color: #007bff;
        color: #fff;
        padding: 15px 25px;
        border-radius: 50px;
        font-size: 18px;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: background-color 0.3s ease;
    }
    label:hover {
        background-color: #0056b3;
    }
    button[type="submit"] {
        cursor: pointer;
        background-color: #28a745;
        color: #fff;
        border: none;
        padding: 15px 25px;
        border-radius: 50px;
        font-size: 18px;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: background-color 0.3s ease;
    }
    button[type="submit"]:hover {
        background-color: #218838;
    }
    .graphs {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
    }
    .graph {
        margin: 20px;
        text-align: center;
    }
    img {
        max-width: 100%;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }
    html {
background: #F2F2F2;
}

.logo-holder {
background: #232121;
width: 1px;
height: 220px;
position: relative;
margin: 0 auto ;
padding-top: 15px;
padding-bottom: 24px;

}

.bg {

position: absolute;
top: 9px;
left: 8px;
right: 8px;
bottom: 10px;
background: url(http://boutique.flarework.com/wp-content/themes/boutique/img/logo_large.png) center 0px no-repeat ;
background-size: contain;

}

.bar {
position: relative;
height: 8px;
background: #0c4dd8;
width:  0%;
top: 0px;
left: 18px;
margin-top: 8px;
box-shadow: 0 0 3px rgba(8, 8, 8, 0.9);
animation: fill 5s infinite alternate, colors 5s infinite alternate;
}

.bar.fill1 {
animation: fill-1 5s infinite alternate, colors 5s infinite alternate;
}

.bar.fill2 {
animation:  fill-2 5s infinite alternate, colors 5s infinite alternate;
}


.bar.fill3 {
animation:  fill-3 5s infinite alternate, colors 5s infinite alternate;
}


.bar.fill4 {
animation:  fill-4 5s infinite alternate, colors 5s infinite alternate;
}

.bar.fill5 {
animation:  fill-5 5s infinite alternate, colors 5s infinite alternate;
}

.bar.fill6 {
animation:  fill-6 5s infinite alternate, colors 5s infinite alternate;
}



@keyframes fill {
0%   { width: 0; }
33%  { width: 30px;}
66%  { width: 10px;}
100% { width: 105px; }
}

@keyframes fill-1 {
0%   { width: 0; }
33%  { width: 50px;}
66%  { width: 20px;}
100% { width: 130px; }
}

@keyframes fill-2 {
0%   { width: 0; }
33%  { width: 90px;}
66%  { width: 70px;}
100% { width: 136px; }
}

@keyframes fill-3 {
0%   { width: 0; }
33%  { width: 50px;}
66%  { width: 24px;}
100% { width: 109px; }
}

@keyframes fill-4 {
0%   { width: 0; }
33%  { width: 98px;}
66%  { width: 34px;}
100% { width: 99px; }
}

@keyframes fill-5 {
0%   { width: 0; }
33%  { width: 30px;}
66%  { width: 10px;}
100% { width: 148px; }
}


@keyframes fill-6 {
0%   { width: 0; }
33%  { width: 48px;}
66%  { width: 22px;}
100% { width: 140px; }
}

@keyframes colors {
0% { background-color: #5a5a5a;}
50% { background-color: #3a3;}
100% { background-color: #6a6a6a;}
}
body {
margin: auto;
font-family: -apple-system, BlinkMacSystemFont, sans-serif;
overflow: auto;
background: linear-gradient(315deg, rgba(101,0,94,1) 3%, rgba(60,132,206,1) 38%, rgba(48,238,226,1) 68%, rgba(255,25,25,1) 98%);
animation: gradient 15s ease infinite;
background-size: 400% 400%;
background-attachment: fixed;
}


@keyframes gradient {
0% {
background-position: 0% 0%;
}
50% {
background-position: 100% 100%;
}
100% {
background-position: 0% 0%;
}
}

.wave {
background: rgb(255 255 255 / 25%);
border-radius: 1000% 1000% 0 0;
position: fixed;
width: 100vw; /* Changed to vw */
height: 100vh; /* Added */
animation: wave 10s -3s linear infinite;
transform: translate3d(0, 0, 0);
opacity: 0.8;
bottom: 0;
left: 0;
z-index: -1;
}

.wave:nth-of-type(2) {
bottom: -1.25em;
animation: wave 18s linear reverse infinite;
opacity: 0.8;
}

.wave:nth-of-type(3) {
bottom: -2.5em;
animation: wave 20s -1s reverse infinite;
opacity: 0.9;
}

@keyframes wave {
2% {
transform: translateX(1);
}

25% {
transform: translateX(-25%);
}

50% {
transform: translateX(-50%);
}

75% {
transform: translateX(-25%);
}

100% {
transform: translateX(1);
}
}
body {
margin: auto;
font-family: -apple-system, BlinkMacSystemFont, sans-serif;
background: linear-gradient(315deg, rgba(101,0,94,1) 3%, rgba(60,132,206,1) 38%, rgba(48,238,226,1) 68%, rgba(255,25,25,1) 98%);
animation: gradient 15s ease infinite;
background-size: 400% 400%;
background-attachment: fixed;
height: 100vh; /* Added */
}

@keyframes gradient {
0% {
background-position: 0% 0%;
}
50% {
background-position: 100% 100%;
}
100% {
background-position: 0% 0%;
}
}

.wave {
background: rgb(255 255 255 / 25%);
border-radius: 1000% 1000% 0 0;
position: fixed;
width: 100vw; /* Changed to vw */
height: 100vh; /* Added */
animation: wave 10s -3s linear infinite;
transform: translate3d(0, 0, 0);
opacity: 0.8;
bottom: 0;
left: 0;
z-index: -1;
}

.wave:nth-of-type(2) {
bottom: -1.25em;
animation: wave 18s linear reverse infinite;
opacity: 0.8;
}

.wave:nth-of-type(3) {
bottom: -2.5em;
animation: wave 20s -1s reverse infinite;
opacity: 0.9;
}

@keyframes wave {
2% {
transform: translateX(1);
}

25% {
transform: translateX(-25%);
}

50% {
transform: translateX(-50%);
}

75% {
transform: translateX(-25%);
}

100% {
transform: translateX(1);
}
}

#export-png {
            cursor: pointer;
            background-color: #dc3545;
            color: #fff;
            border: none;
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: background-color 0.3s ease;
        }
        #export-png:hover {
            background-color: #c82333;
        }


</style>
</head>
<body>
    <div class="navbar">
        <div>
            <a href="#about">About Us</a>
            <a href="#contact">Contact Us</a>
            <a href="#idea">Our Idea</a>
        </div>
        <div id="current-time"></div> <!-- Container for displaying current time -->
    </div>
    <div class="container">
        <h1>Medical History Analysis</h1>
        <form method="post" enctype="multipart/form-data">
            <label for="file">Upload CSV</label>
            <input type="file" name="file" id="file" accept=".csv" required>
            <button type="submit">Load CSV</button>
        </form>
        {% if filename %}
            <p>File "{{ filename }}" loaded.</p> <!-- Display loaded file name -->
        {% endif %}
        {% if graphs %}
            <div class="graphs">
                {% for column, graph_url, column_type in graphs %}
                    <div class="graph">
                        <h3>Distribution of {{ column }}</h3>
                        <img src="data:image/png;base64,{{ graph_url }}" alt="{{ column }}">
                        {% if column_type == 'numeric' %}
                            <input type="range" min="{{ thresholds[column][0] }}" max="{{ thresholds[column][1] }}" value="{{ thresholds[column][0] }}" class="min-threshold-slider" data-column="{{ column }}">
                            <input type="range" min="{{ thresholds[column][0] }}" max="{{ thresholds[column][1] }}" value="{{ thresholds[column][1] }}" class="max-threshold-slider" data-column="{{ column }}">
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            <button id="export-png" onclick="exportToPng()">Export to PNG</button>
            <p style="margin-top: 10px;">Red lines mean danger zones</p>

        {% endif %}
    </div>

    <script>

function exportToPng() {
    // Select all graph images
    var graphs = document.querySelectorAll('.graph img');

    // Create a canvas element
    var canvas = document.createElement('canvas');
    var ctx = canvas.getContext('2d');

    // Set canvas size to accommodate all images
    var totalHeight = 0;
    var maxWidth = 0;
    graphs.forEach(function(graph) {
        totalHeight += graph.height;
        maxWidth = Math.max(maxWidth, graph.width);
    });
    canvas.width = maxWidth;
    canvas.height = totalHeight;

    // Draw each graph image onto the canvas
    var offsetY = 0;
    graphs.forEach(function(graph) {
        ctx.drawImage(graph, 0, offsetY);
        offsetY += graph.height;
    });

    // Convert the canvas to a data URL representing a PNG image
    var pngUrl = canvas.toDataURL('image/png');

    // Create a temporary anchor element to trigger the download
    var a = document.createElement('a');
    a.href = pngUrl;
    a.download = 'graphs.png';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}



       function exportToPdf() {
    // Create a new jsPDF instance
    var pdf = new jsPDF();

    // Get the HTML content of the container element
    var element = document.querySelector('.container');

    // Generate the PDF from the HTML content
    pdf.html(element, {
        callback: function(pdf) {
            // Save the PDF file
            pdf.save('medical_history_analysis.pdf');
        }
    });
}



        // Update current time
        function updateTime() {
            var currentTime = new Date();
            var hours = currentTime.getHours();
            var minutes = currentTime.getMinutes();
            var seconds = currentTime.getSeconds();
            var ampm = hours >= 12 ? 'PM' : 'AM';

            hours = hours % 12;
            hours = hours ? hours : 12; // Handle midnight
            minutes = minutes < 10 ? '0' + minutes : minutes;
            seconds = seconds < 10 ? '0' + seconds : seconds;

            var timeString = hours + ':' + minutes + ':' + seconds + ' ' + ampm;
            document.getElementById('current-time').textContent = timeString;
        }

        // Update time every second
        setInterval(updateTime, 1000);

        // Your existing JavaScript code
    </script>

   <script>
    function summarizeGraphs() {
        var graphs = document.querySelectorAll('.graph img');
        var summaries = [];
        graphs.forEach(function(graph) {
            var imgData = graph.src;
            summaries.push({image: imgData});
        });

        fetch('/summarize-graphs', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(summaries)
        }).then(function(response) {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        }).then(function(data) {
            displaySummaries(data);
        }).catch(function(error) {
            console.error('Error summarizing graphs:', error);
            alert('Error summarizing graphs. Please try again.');
        });
    }

    function displaySummaries(summaries) {
            var summaryContainer = document.getElementById('summary-container');
            summaryContainer.innerHTML = ''; // Clear previous content

            summaries.forEach(function(summary) {
                var summaryElement = document.createElement('p');
                summaryElement.textContent = summary;
                summaryContainer.appendChild(summaryElement);
            });
        }
</script>

<div class="logo-holder">
    <div class="bg"></div>
    <div class="bar"></div>
    <div class="bar fill1"></div>
    <div class="bar fill2"></div>
    <div class="bar fill3"></div>
    <div class="bar fill4"></div>
    <div class="bar fill1"></div>
    <div class="bar fill5"></div>
    <div class="bar fill6"></div>
    <div class="bar"></div>
  </div>
  <body>
    <div>
       <div class="wave"></div>
       <div class="wave"></div>
       <div class="wave"></div>
    </div>
  </body>

</body>
</html>